## 第1章 Java 内存区域与内存溢出异常

### 2.1 运行时数据区域

![Java虚拟机运行时数据区](./pictures/jvm1.png)

- 程序计数器：程序计数器是一块较小的内存空间，它可以看作是当前线程所执行的字节码的行号指示器。在虚拟机的概念模型里，字节码解释器就是通过改变这个计数器的值来选取下一条需要执行的字节码指令。由于 Java 虚拟机的多线程是通过线程轮流切换并分配处理器执行时间的方式来实现的，为了线程切换后能恢复到正确的执行位置，每条线程都需要有一个独立的程序计数器，独立存储互不影响。
- 虚拟机栈：与程序计数器一样，虚拟机栈也是线程私有的，它的生命周期与线程相同。
- 本地方法栈：与虚拟机栈发挥的作用相似，不过本地方法栈则是为虚拟机使用到的 Native 方法服务。
- 堆：Java 堆是虚拟机所管理的内存中最大的一块。Java 堆是被所有线程共享的一块内存区域，用于存放对象实例（所有的对象实例以及数组）。Java 堆是垃圾收集器管理的主要区域，由于垃圾收集器基于分代收集算法，所以 Java 堆还可以细分为：新生代和老年代；在细致一点的有 Eden 空间、From Survivor 空间、To Survivor 空间等。
- 方法区：与 Java 堆一样，也是线程共享的内存区域，它用于存储已被虚拟机加载的类信息、常亮、静态变量、即时编译后的代码等数据。
- 运行时常量池：运行时常量池是方法区的一部分。Class 文件中除了有类的版本、字段、方法、接口等描述信息外，还有一项信息是常量池，用于存放编译期生成的各种字面量和符号引用，这部分内容将在类加载后进入方法区的常量池中存放。
- 直接内存：直接内存（Direct Memory）并不是虚拟机运行时数据区的一部分，也不是 Java 虚拟机规范中定义的内存区域。在 JDK1.4中 NIO 类，引入了一种基于通道（Channel）与缓冲区（Buffer）的 I/O 方式，它可以使用 Native 函数库直接分配堆外内存，然后通过一个存储在 Java 堆中的 DirectByteBuffer 对象作为这块内存的引用进行操作。这样能在一些场景中显著提高性能（避免了在 Java 堆和 Native 堆中来回复制数据）。直接内存的分配不会受到 Java 堆大小的限制，但受到机器总内存大小以及处理器寻址空间的限制。